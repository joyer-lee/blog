<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="前端开发,web3d"><meta name="description" content="JOY的个人博客"><meta name="author" content="Joyer Lee"><title>vscode源码初识（一） | Joyer</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.svg"><link rel="stylesheet" href="/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"lhx.blog.wj2015.com",root:"/",language:"zh-CN",path:"search.xml"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!1},style:{primary_color:"#0066CC",avatar:"/images/avatar.jpg",favicon:"/images/logo.svg",article_img_align:"left",left_side_width:"260px",content_max_width:"920px",hover:{shadow:!1,scale:!1},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"细线常锯木必断，檐水久滴石必穿"},scroll:{progress_bar:{enable:!1},percent:{enable:!1}}},local_search:{enable:!0,preload:!1},code_copy:{enable:!1,style:"default"},pjax:{enable:!1},lazyload:{enable:!1},version:"3.4.5"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"}</script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="progress-bar-container"></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/images/avatar.jpg"> </a><a class="logo-title" href="/">Joyer</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">vscode源码初识（一）</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="info"><div class="author"><span class="name">Joyer Lee</span> <span class="author-label">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-edit"></i>&nbsp; <span class="pc">2020-11-11 15:16:38</span> <span class="mobile">2020-11-11 15:16</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/vscode%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">vscode源码解读</a>&nbsp;</li><li>&gt; <a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>&nbsp;</li></ul></span></div></div></div></div><div class="article-content markdown-body"><html><head></head><body><h2 id="导读"><a href="#导读" class="headerlink" title="导读"></a>导读</h2><p><em>公司规划要做一个IDE，经过前期产品调研，确认以vscode源码为研究对象，基于vscode开发一款新的IDE产品，所以我有较长的时间需要啃懂vscode相关的技术实现，由于前期对vscode涉及的相关技术，如typescript、electron、nodejs缺乏系统了解，也无相关开发经验，因此读懂vscode源码对我来说是个大工程，希望通过博客能记录学习过程、梳理相关概念、总结技术难点，帮助我更好的上手IDE开发</em></p><blockquote><p>本系列前期仅能对vscode源码进行一些相对浅显的理解，后期随着项目深入，将由浅入深的分享一些开发细节。</p></blockquote><h2 id="本章目标"><a href="#本章目标" class="headerlink" title="本章目标"></a>本章目标</h2><p>前期研究目标</p><blockquote><ol><li>启动vscode源码</li><li>了解vscode源码基本结构</li><li>了解vscode模块与模块之前的运作</li><li>了解导航栏的基本操作</li></ol></blockquote><h2 id="vscode源码运行"><a href="#vscode源码运行" class="headerlink" title="vscode源码运行"></a>vscode源码运行</h2><p>不管有没有vscode相关技术，首先需要先认识一下vscode源码的基本结构和启动流程，便于在随后的学习过程中有个侧重点。 关于启动vscode源码，网上有很多参考教程，我这里大致做一个流程总结。具体参考<a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/liulun/p/11037537.html" title="在这里">在这里<i class="fas fa-external-link-alt"></i></a>。</p><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">安装git，nodejs和yarn</span><br><span class="line">安装Python27，3.x版本的不行，确保它在你的环境变量里；</span><br><span class="line">安装gulp</span><br><span class="line">npm install --global gulp-cli</span><br><span class="line"></span><br><span class="line">安装windows build tools：</span><br><span class="line">npm install --global windows-build-tools --2017</span><br><span class="line"></span><br><span class="line">安装node-gyp</span><br><span class="line">npm install -g node-gyp</span><br><span class="line"></span><br><span class="line">**用管理员的方式打开powershell**，不是管理员身份不行</span><br><span class="line">在源码根目录下执行：</span><br><span class="line">yarn 安装相关包</span><br><span class="line">yarn watch 编译项目</span><br><span class="line"></span><br><span class="line">yarn web 在浏览器中打开</span><br><span class="line"></span><br><span class="line">webstorm可通过配置启动项启动vscode客户端，由于我使用的是vscode编辑器，目前是通过双击打开vscode源码目录下的scripts/code.bat文件打开客户端，mac用户可双击scripts/code.sh文件</span><br></pre></td></tr></tbody></table></figure><h2 id="vscode基本认识"><a href="#vscode基本认识" class="headerlink" title="vscode基本认识"></a>vscode基本认识</h2><h3 id="核心技术"><a href="#核心技术" class="headerlink" title="核心技术"></a>核心技术</h3><p><img src="/images/uploads/sites/2/2020/11/QQ%E6%88%AA%E5%9B%BE20201111100348.png"> - 使用 Web 技术来编写 UI，用 chrome 浏览器内核来运行 - 使用 NodeJS 来操作文件系统和发起网络请求 - 使用 NodeJS C++ Addon 去调用操作系统的 native API</p><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── azure-pipelines.yml</span><br><span class="line">├── build/</span><br><span class="line">├── extensions/</span><br><span class="line">├── gulpfile.js</span><br><span class="line">├── out/</span><br><span class="line">├── package.json</span><br><span class="line">├── product.json</span><br><span class="line">├── resources/</span><br><span class="line">├── scripts/</span><br><span class="line">├── src/</span><br><span class="line">│   ├── main.js</span><br><span class="line">│   └── vs</span><br><span class="line">│       ├── base/</span><br><span class="line">│       ├── code/</span><br><span class="line">│            ├── browser/</span><br><span class="line">│                 ├── workbench.ts</span><br><span class="line">│                 └── workbench/workbench.html</span><br><span class="line">│            ├── electron-browser/</span><br><span class="line">│                 ├── workbench.js</span><br><span class="line">│                 └── workbench/workbench.html</span><br><span class="line">│            └── electron-main/</span><br><span class="line">│                 ├── main.ts</span><br><span class="line">│                 └── window.ts</span><br><span class="line">│       ├── editor/</span><br><span class="line">│       ├── platform/</span><br><span class="line">│       ├── server/</span><br><span class="line">│       └── workbench/</span><br><span class="line">└── test/ //放的是各种自动化、冒烟、UI 测试脚本，这里值得学习和研究下</span><br></pre></td></tr></tbody></table></figure><p>目录解析 - azure-pipelines.yml，它是一个 CI/CD 的配置，自动测试、构建、打包 - build/，这里面放的是 VS Code 项目的构建工具，相对来说还是比较复杂的，主要是因为它顾及了 Linux/Mac/Windows 三个平台 - extensions/，VS Code 的内置模块，包含各种语言高亮的 LSP 相关模块 - gulpfile.js，构建脚本，暂时不用细看，可以关注 package.json 的 scripts，里面放着一些程序的快捷启动方式，而且针对内存溢出做了防御，如 –max_old_space_size=4095 - out/，构建的结果都放在这个目录下 - package.json，需要着重看看 main 和 scripts 两个字段 - product.json，如果你想根据 VS Code 进行二次开发，建立自己的品牌，建议搞懂这个文件，因为你需要修改它 - resource/，打包构建生成安装包（exe/dmg/deb 等）的时候需要依赖的额外资源 - scripts/，开发过程各种会用到的脚本，用的比较多的可能是 ./scripts/code.sh - test/，放的是各种自动化、冒烟、UI 测试脚本，这里值得学习和研究下 - src/，核心源码</p><h3 id="结构细分"><a href="#结构细分" class="headerlink" title="结构细分"></a>结构细分</h3><p>一下内容均摘抄至<a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/96041706" title="从 VSCode 看大型 IDE 技术架构">《从 VSCode 看大型 IDE 技术架构》<i class="fas fa-external-link-alt"></i></a>。 1. 隔离内核 (src) 与插件 (extensions)，内核分层模块化</p><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/src/vs：分层和模块化的 core</span><br><span class="line">/src/vs/base: 通用的公共方法和公共视图组件</span><br><span class="line">/src/vs/code: VSCode 应用主入口</span><br><span class="line">/src/vs/platform：可被依赖注入的各种纯服务</span><br><span class="line">/src/vs/editor: 文本编辑器</span><br><span class="line">/src/vs/workbench：整体视图框架</span><br><span class="line">/src/typings: 公共基础类型</span><br><span class="line">/extensions：内置插件</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>每层按环境隔离 内核里面每一层代码都会遵守 electron 规范，按不同环境细分文件夹:</li></ol><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">common: 公共的 js 方法，在哪里都可以运行的</span><br><span class="line">browser: 只使用浏览器 API 的代码，可以调用 common</span><br><span class="line">node: 只使用 NodeJS API 的代码，可以调用 common</span><br><span class="line">electron-browser: 使用 electron 渲染线程和浏览器 API 的代码，可以调用 common，browser，node</span><br><span class="line">electron-main: 使用 electron 主线程和 NodeJS API 的代码，可以调用 common， node</span><br><span class="line">test: 测试代码</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>内核代码本身也采用扩展机制: Contrib 可以看到 /src/vs/workbench/contrib 这个目录下存放着非常多的 VSCode 的小的功能单元：</li></ol><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── backup</span><br><span class="line">├── callHierarchy</span><br><span class="line">├── cli</span><br><span class="line">├── codeActions</span><br><span class="line">├── codeEditor</span><br><span class="line">├── comments</span><br><span class="line">├── configExporter</span><br><span class="line">├── customEditor</span><br><span class="line">├── debug</span><br><span class="line">├── emmet</span><br><span class="line">├──....中间省略无数....</span><br><span class="line">├── watermark</span><br><span class="line">├── webview</span><br><span class="line">└── welcome</span><br></pre></td></tr></tbody></table></figure><p>Contrib 有一些特点：</p><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Contrib 目录下的所有代码不允许依赖任何本文件夹之外的文件</span><br><span class="line">Contrib 主要是使用 Core 暴露的一些扩展点来做事情</span><br><span class="line">每一个 Contrib 如果要对外暴露，将API 在一个出口文件里面导出 eg: contrib/search/common/search.ts</span><br><span class="line">一个 Contrib 如果要和另一个 Contrib 发生调用，不允许使用除了出口 API 文件之外的其它文件</span><br><span class="line">接上一条，即使 Contrib 事实上可以调用另一个 Contrib 的出口 API，也要审慎的考虑并尽量避免两个 Contrib 互相依赖</span><br></pre></td></tr></tbody></table></figure><h2 id="vscode启动流程"><a href="#vscode启动流程" class="headerlink" title="vscode启动流程"></a>vscode启动流程</h2><p>具体可参照<a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/96041706" title="从 VSCode 看大型 IDE 技术架构">《从 VSCode 看大型 IDE 技术架构》<i class="fas fa-external-link-alt"></i></a>关于启动流程的精简链路解读。 <strong>简要描述：</strong> - 入口是 src/main.js - 主进程（Main Process） 的实际调用路径是: <code>main.js -&gt; vs/code/electron-main/main.ts -&gt; vs/code/electron-main/window.ts</code> 在 <code>window.ts</code> 启动了一个<code>BrowserWindow</code> 加载了 <code>vs/code/electron-browser/workbench/workbench.html</code> - 渲染进程（Renderer Process）的实际路径是： <code>vs/code/electron-browser/workbench/workbench.html -&gt; vs/code/electron-browser/workbench/workbench.js</code> 核心逻辑在 <code>workbench.js</code> 中，而 src 下还有一个核心目录 <code>browser</code>，它是 Web 版本的启动入口</p><h3 id="未完待续。。。"><a href="#未完待续。。。" class="headerlink" title="未完待续。。。"></a>未完待续。。。</h3><h2 id="vscode代码调试"><a href="#vscode代码调试" class="headerlink" title="vscode代码调试"></a>vscode代码调试</h2><h2 id="vscode导航栏调试分析"><a href="#vscode导航栏调试分析" class="headerlink" title="vscode导航栏调试分析"></a>vscode导航栏调试分析</h2></body></html></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>本文标题：vscode源码初识（一）</li><li>本文作者：Joyer Lee</li><li>创建时间：2020-11-11 15:16:38</li><li>本文链接：https://lhx.blog.wj2015.com/2020/11/11/vscode-meet-1/</li><li>版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2020/12/04/vscode-source-organization/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">vscode源码组织</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2020/10/29/front-end-animation-implementation/"><span class="title flex-center"><span class="post-nav-title-item">前端页面动画实现方式</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span> - 2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Joyer Lee</a></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><aside class="page-aside"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E8%AF%BB"><span class="nav-number">1.</span> <span class="nav-text">导读</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E7%AB%A0%E7%9B%AE%E6%A0%87"><span class="nav-number">2.</span> <span class="nav-text">本章目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode%E6%BA%90%E7%A0%81%E8%BF%90%E8%A1%8C"><span class="nav-number">3.</span> <span class="nav-text">vscode源码运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86"><span class="nav-number">4.</span> <span class="nav-text">vscode基本认识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="nav-number">4.1.</span> <span class="nav-text">核心技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">4.2.</span> <span class="nav-text">目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E7%BB%86%E5%88%86"><span class="nav-number">4.3.</span> <span class="nav-text">结构细分</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">5.</span> <span class="nav-text">vscode启动流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AA%E5%AE%8C%E5%BE%85%E7%BB%AD%E3%80%82%E3%80%82%E3%80%82"><span class="nav-number">5.1.</span> <span class="nav-text">未完待续。。。</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95"><span class="nav-number">6.</span> <span class="nav-text">vscode代码调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode%E5%AF%BC%E8%88%AA%E6%A0%8F%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90"><span class="nav-number">7.</span> <span class="nav-text">vscode导航栏调试分析</span></a></li></ol></div></div></aside><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script><script src="/js/local-search.js"></script><div class="post-scripts"><script src="/js/left-side-toggle.js"></script><script src="/js/libs/anime.min.js"></script><script src="/js/toc.js"></script></div></body></html>