<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="前端开发,web3d"><meta name="description" content="JOY的个人博客"><meta name="author" content="Joyer Lee"><title>vscode源码组织 | Joyer</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.svg"><link rel="stylesheet" href="/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"lhx.blog.wj2015.com",root:"/",language:"zh-CN",path:"search.xml"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!1},style:{primary_color:"#0066CC",avatar:"/images/avatar.jpg",favicon:"/images/logo.svg",article_img_align:"left",left_side_width:"260px",content_max_width:"920px",hover:{shadow:!1,scale:!1},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"细线常锯木必断，檐水久滴石必穿"},scroll:{progress_bar:{enable:!1},percent:{enable:!1}}},local_search:{enable:!0,preload:!1},code_copy:{enable:!1,style:"default"},pjax:{enable:!1},lazyload:{enable:!1},version:"3.4.5"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"}</script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="progress-bar-container"></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/images/avatar.jpg"> </a><a class="logo-title" href="/">Joyer</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">vscode源码组织</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="info"><div class="author"><span class="name">Joyer Lee</span> <span class="author-label">Lv2</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-edit"></i>&nbsp; <span class="pc">2020-12-04 14:47:07</span> <span class="mobile">2020-12-04 14:47</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/vscode%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">vscode源码解读</a>&nbsp;</li></ul></span></div></div></div></div><div class="article-content markdown-body"><html><head></head><body><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>vscode由一个分层的、模块化的<code>core</code>组成（即src/vs目录），它可以通过<code>extensions</code>机制进行扩展。<code>extensions</code>运行在称为<code>extension host</code>的单独进程中,通过使用<code>extensions API</code>去实现。</p><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><h3 id="根目录结构"><a href="#根目录结构" class="headerlink" title="根目录结构"></a>根目录结构</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├── build       # gulp编译构建脚本 </span><br><span class="line">├── extensions  # 内置插件 </span><br><span class="line">├── out         # 编译输出目录</span><br><span class="line">├── resources     # 平台相关静态资源，图标等 </span><br><span class="line">├── scripts       # 工具脚本，开发/测试 </span><br><span class="line">├── src           # 源码目录 </span><br><span class="line">└── test          # 测试套件</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="src下文件目录结构"><a href="#src下文件目录结构" class="headerlink" title="src下文件目录结构"></a>src下文件目录结构</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">├── bootstrap-amd.js    # 子进程实际入口</span><br><span class="line">├── bootstrap-fork.js   #</span><br><span class="line">├── bootstrap-window.js #</span><br><span class="line">├── bootstrap.js        # 子进程环境初始化</span><br><span class="line">├── buildfile.js        # 构建config</span><br><span class="line">├── cli.js              # CLI入口</span><br><span class="line">├── main.js             # 主进程入口</span><br><span class="line">├── paths.js            # AppDataPath与DefaultUserDataPath</span><br><span class="line">├── typings</span><br><span class="line">│          └── xxx.d.ts        # ts类型声明</span><br><span class="line">└── vs   </span><br><span class="line">    ├── base            # 定义基础的工具方法和基础的 DOM UI 控件   </span><br><span class="line">        │   ├── browser     # 基础UI组件，DOM操作、交互事件、DnD等  </span><br><span class="line">        │   ├── common      # diff描述，markdown解析器，worker协议，各种工具函数     </span><br><span class="line">        │   ├── node        # Node工具函数   </span><br><span class="line">        │   ├── parts       # IPC协议（Electron、Node），quickopen、tree组件   </span><br><span class="line">        │   ├── test        # base单测用例    </span><br><span class="line">        │   └── worker      # Worker factory 和 main Worker（运行IDE Core：Monaco）</span><br><span class="line">    ├── code            # VSCode Electron 应用的入口，包括 Electron 的主进程脚本入口   </span><br><span class="line">        │   ├── electron-browser # 需要 Electron 渲染器处理API的源代码（可以使用 common, browser, node）</span><br><span class="line">        │   ├── electron-main    # 需要Electron主进程API的源代码（可以使用 common, node）   </span><br><span class="line">        │   ├── node        # 需要Electron主进程API的源代码（可以使用 common, node）  </span><br><span class="line">        │   ├── test  </span><br><span class="line">        │   └── code.main.ts </span><br><span class="line"></span><br><span class="line">    ├── editor   # Monaco Editor 代码编辑器：其中包含单独打包发布的 Monaco Editor 和只能在 VSCode 的使用的部分    </span><br><span class="line">        │   ├── browser     # 代码编辑器核心   </span><br><span class="line">        │   ├── common      # 代码编辑器核心   </span><br><span class="line">        │   ├── contrib     # vscode 与独立 IDE共享的代码 </span><br><span class="line">        │   ├── standalone  # 独立 IDE 独有的代码 </span><br><span class="line">        │   ├── test    │   ├── editor.all.ts  </span><br><span class="line">        │   ├── editor.api.ts   </span><br><span class="line">        │   ├── editor.main.ts </span><br><span class="line">        │   └── editor.worker.ts  </span><br><span class="line">    ├── platform        # 依赖注入的实现和 VSCode 使用的基础服务 Services   </span><br><span class="line">    ├── workbench       # VSCode 桌面应用程序工作台的实现 </span><br><span class="line">    ├── buildunit.json   </span><br><span class="line">    ├── css.build.js    # 用于插件构建的CSS loader   </span><br><span class="line">    ├── css.js          # CSS loader   </span><br><span class="line">    ├── loader.js       # AMD loader（用于异步加载AMD模块，类似于require.js） </span><br><span class="line">    ├── nls.build.js    # 用于插件构建的 NLS loader   </span><br><span class="line">    └── nls.js          # NLS（National Language Support）多语言loader   </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="层级"><a href="#层级" class="headerlink" title="层级"></a>层级</h2><p><code>core</code>分为以下几层：</p><ul><li><code>base</code>: 提供常规实用程序和用户界面构建块</li><li><code>platform</code>: 为VS Code定义服务注入支持和基本服务</li><li><code>editor</code>: “ Monaco”编辑器可作为单独的可下载组件使用</li><li><code>workbench</code>: 托管“Monaco”编辑器，并提供“视口”的框架，例如资源管理器，状态栏或菜单栏，并利用Electron来实现VS Code桌面应用程序。</li></ul><h2 id="目标环境"><a href="#目标环境" class="headerlink" title="目标环境"></a>目标环境</h2><p>VS Code的核心完全采用TypeScript实现。在每一层内部，代码都是由目标运行时环境组成的。这样可以确保仅使用运行时特定的API。在代码中，我们对目标环境做以下区分：</p><ul><li><p><code>common</code>目录存放的是：仅需要基本的JavaScript API，并且可以运行在其他目标环境中的源代码</p></li><li><p><code>browser</code>目录存放的是：需要访问browserAPI如进行DOM操作的源代码。 可以引入<code>common</code>目录下的源码</p></li><li><p><code>node</code>目录存放的是：引入nodejs API的源码。 可以引入<code>common</code>目录下的源码</p></li><li><p><code>electron-sandbox</code>目录存放的是：即需要访问browserAPI如进行DOM操作和要求浏览器API，也需要操作一小部分ElectronAPI用来和Electron主进程进行通信的源代码。 可以使用<code>common</code>、<code>browser</code>、<code>electron-sandbox</code>目录下的源码。</p></li><li><p><code>electro-browser</code>目录存放的是：引入了electron 渲染进程API的源码。 可以使用<code>common</code>、<code>browser</code>、<code>node</code>目录文件。</p></li><li><p><code>electron-main</code>目录存放的是：引入了electron主进程API的源码。 可以使用<code>common</code>、<code>node</code>目录源码。</p></li></ul><h2 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h2><p>源码是通过<code>services</code>组成的，<code>services</code>更多的被定义在<code>platform</code>层中。<code>Services</code>通过<code>construction injection</code>（构造函数注入）的方式得到对应的客户端（clients）。 <code>service</code>定义分为两部分： （1）（<code>service</code>）服务的接口（<code>interface</code>） （2）服务(<code>service</code>)标识符(<code>identifier</code>) 服务标识符是必需的，因为<code>TypeScript</code>不使用标称类型而是结构性类型。 服务标识符是一种修饰器（针对<code>ES7</code>提出），并且应与服务接口具有相同的名称。 声明服务依赖关系是通过在构造函数参数中添加相应的修饰来实现的。 在下面的代码段中，<code>@ IModelService</code>是服务标识符修饰符，而<code>IModelService</code>是此参数的（可选）类型注释。 如果依赖项是可选的，请使用<code>@optional</code>装饰，否则实例化服务将引发错误。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Client {</span><br><span class="line">  constructor(</span><br><span class="line">    @IModelService modelService: IModelService, </span><br><span class="line">    @optional(IEditorService) editorService: IEditorService</span><br><span class="line">  ) {</span><br><span class="line">    // use services</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>使用实例化服务为服务使用者创建实例，例如<code>InstantiationService.createInstance（Client）</code>。 通常，当您注册为贡献内容（例如<code>Viewle</code>或<code>Language</code>）时，会为您完成此操作。</p><h2 id="VS-Code-Editor的源组织"><a href="#VS-Code-Editor的源组织" class="headerlink" title="VS Code Editor的源组织"></a>VS Code Editor的源组织</h2><ul><li><code>vs/editor</code>文件夹不应该有任何<code>node</code>或<code>electron-browser</code>依赖关系。</li><li><code>vs/editor/common</code>和<code>vs/editor/browser</code>-代码编辑器核心（若没有这些则编辑器没有任何意义）。</li><li><code>vs/editor/contrib</code>-VS Code和独立编辑器中附带的代码编辑器贡献。依照<code>browser</code>惯例，编辑器在缺失相关<code>contrib</code>的情况下，会导致相应功能被删除。</li><li><code>vs/editor/standalone</code>-仅独立编辑器附带的代码。不存在别的依赖。</li><li><code>vs/workbench/contrib/codeEditor</code> -VS Code中附带的代码编辑器贡献。</li></ul><h2 id="工作台贡献"><a href="#工作台贡献" class="headerlink" title="工作台贡献"></a>工作台贡献</h2><p>VS Code工作台（<code>vs/workbench</code>）由许多内容组成，可提供丰富的开发经验。示例包括全文搜索，集成的git和debug。从本质上讲，工作台并不直接依赖于所有这些贡献。相反，我们使用内部（而不是真正的扩展API）机制将这些<code>contrib</code>贡献给工作台。 贡献给工作台的所有贡献都存放在该<code>vs/workbench/contrib</code>文件夹中。此文件夹中有一些规则：</p><ul><li><code>vs/workbench/contrib</code>文件夹内部代码与外界没有任何依赖关系</li><li>每个贡献都应从单个文件中公开其内部API（例如<code>vs/workbench/contrib/search/common/search.ts</code>）</li><li>一个贡献可以取决于另一个贡献的内部API（例如git贡献可能取决于 <code>vs/workbench/contrib/search/common/search.ts</code>）</li><li>一个贡献永远都不能进入另一个贡献的内部（内部是贡献文件中不存在于单个公共API文件中的其他内容）</li><li>在让一个贡献依赖于另一个贡献之前要三思：这是否确实需要，是否有意义？是否可以通过使用工作台的可扩展性来避免这种依赖性呢？</li></ul></body></html></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>本文标题：vscode源码组织</li><li>本文作者：Joyer Lee</li><li>创建时间：2020-12-04 14:47:07</li><li>本文链接：https://lhx.blog.wj2015.com/2020/12/04/vscode-source-organization/</li><li>版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2020/12/08/vscode-insert-login/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">vscode启动时嵌入登录页面</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2020/11/11/vscode-meet-1/"><span class="title flex-center"><span class="post-nav-title-item">vscode源码初识（一）</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span> - 2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Joyer Lee</a></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><aside class="page-aside"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">目录结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B9%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">根目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#src%E4%B8%8B%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">2.2.</span> <span class="nav-text">src下文件目录结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%82%E7%BA%A7"><span class="nav-number">3.</span> <span class="nav-text">层级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E7%8E%AF%E5%A2%83"><span class="nav-number">4.</span> <span class="nav-text">目标环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="nav-number">5.</span> <span class="nav-text">依赖注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VS-Code-Editor%E7%9A%84%E6%BA%90%E7%BB%84%E7%BB%87"><span class="nav-number">6.</span> <span class="nav-text">VS Code Editor的源组织</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8F%B0%E8%B4%A1%E7%8C%AE"><span class="nav-number">7.</span> <span class="nav-text">工作台贡献</span></a></li></ol></div></div></aside><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script><script src="/js/local-search.js"></script><div class="post-scripts"><script src="/js/left-side-toggle.js"></script><script src="/js/libs/anime.min.js"></script><script src="/js/toc.js"></script></div></body></html>